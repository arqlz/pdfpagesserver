{"version":3,"sources":["public/src/app.tsx","public/src/utls/loader.ts","public/src/getThumbnails.tsx","public/src/crearPDF.tsx"],"names":["useState","useCallback","useEffect","React","docs","sideBarVisivility","setSideBarVisivility","check","a","test","substr","navigator","userAgent","vendor","window","e","height","width","padding","overflow","flexWrap","LeftPanel","PageEditor","list","setList","documents","setDocuments","dropMode","setDropMode","imagenes","d","concat","source_id","target","id","toLocaleLowerCase","toLowerCase","item_index","findIndex","c","target_index","n_list","i","length","push","map","join","dataTransfer","types","includes","preventDefault","text","getData","data","JSON","parse","split","find","swap","crearPDF_1","buffer","file","arrayBuffer","getThumbnails_1","files","f","res","getThumbnailsFromFile","items","kind","getAsFile","procesarYMontarArchivos","input","document","createElement","type","multiple","accept","style","display","body","append","onchange","removeChild","click","img","index","splice","direction","dragoverfile","dropfile","maxHeight","selectFiles","PageItemView","onRemove","onDragEnd","onDragOver","move","background","margin","generarDocumento","imagen","onDrop","onMove","mark","setMark","gray","setGray","setData","stringify","stopPropagation","paddingBottom","borderWidth","borderColor","backgroundColor","ondragover","ondragleave","ondragstart","remove","float","paddingTop","className","marginTop","borderTop","fontSize","fontWeight","pdfjsLib","GlobalWorkerOptions","workerSrc","loader_1","ReactDOM","render","MainApp","getElementById","startApp","url","fetch","then","path","Promise","resolve","reject","exports","getDocument","promise","doc","paginas","numPages","page_index","canvas","canvasContext","getContext","page","getPage","viewport","getViewport","scale","toDataURL","page_number","catch","err","console","error","alert","order","form","FormData","Blob","file_id","method","response","log","blob","URL","createObjectURL","href","download","appendChild"],"mappings":"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","file":"","sourcesContent":["\r\nimport { getPDFTEST } from \"./utls/loader\";\r\nexport declare const pdfjsLib: typeof import(\"pdfjs-dist\")\r\ndeclare const React: typeof import(\"react\")\r\ndeclare const ReactDOM: typeof import(\"react-dom\")\r\nvar {useState, useCallback, useEffect} = React;\r\nimport { getThumbnails } from \"./getThumbnails\";\r\nimport { crearPDF } from \"./crearPDF\";\r\n\r\ninterface ImageItem {\r\n    id: string;\r\n    data?: string;\r\n    page_number: number;\r\n}\r\ninterface PDFDocuments {\r\n    buffer: ArrayBuffer;\r\n    imagenes: ImageItem[]\r\n}\r\n\r\n\r\nfunction MainApp({docs}: {docs: PDFDocuments[]}) {\r\n    var [sideBarVisivility, setSideBarVisivility] = useState(true)\r\n    useEffect(() => {\r\n        let check = false;\r\n        (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window[\"opera\"]);\r\n        if (check) setSideBarVisivility(false)\r\n\r\n    }, [])\r\n    return <div className=\"column main\">\r\n        <div onClick={e => setSideBarVisivility(!sideBarVisivility) } style={{height: 55}} >\r\n            <img style={{width: 30, padding: 10}} src=\"imgs/outline_menu_black_24dp.png\" />\r\n        </div>\r\n        <div className=\"row flex\" style={{overflow: \"hidden\", flexWrap: \"nowrap\"}}>        \r\n            <LeftPanel className={sideBarVisivility? \"\" : \"sidebarhide\"} />               \r\n            <PageEditor docs={docs} />\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction PageEditor({docs}: {docs: PDFDocuments[]}) {\r\n    var [list, setList] = useState([])\r\n    var [documents, setDocuments] = useState(docs)\r\n    var [dropMode, setDropMode] = useState(false)\r\n    useEffect(() => {\r\n        var imagenes = []\r\n        for (var d of documents) imagenes = imagenes.concat(d.imagenes)\r\n        setList(imagenes)\r\n\r\n    }, [])\r\n\r\n    function swap(source_id, target) {\r\n        var id = source_id.toLocaleLowerCase()\r\n\r\n        if (id == target.toLowerCase()) return\r\n        var item_index = list.findIndex(c => c.id.toLocaleLowerCase() == id)\r\n        var target_index = list.findIndex(c => c.id == target)  \r\n        var n_list = [];\r\n        \r\n        for (var i in list) {\r\n            if ( n_list.length == target_index ) n_list.push(list[item_index])\r\n            if (list[i].id.toLowerCase() != id) n_list.push(list[i])\r\n        }\r\n\r\n        if (n_list.findIndex(c => c.id == list[item_index].id) == -1) n_list.push(list[item_index])     \r\n\r\n        if (n_list.map(c=>c.id).join(\"\") != list.map(c=>c.id).join(\"\") ) setList(n_list)  \r\n    }\r\n\r\n    function onDragOver(e, target) {   \r\n        if (e.dataTransfer.types.includes(\"Files\") ) {\r\n            e.preventDefault();\r\n            setDropMode(true)\r\n            return\r\n        }\r\n        var text = e.dataTransfer.getData(\"text\");\r\n        if (text) {\r\n            var data = JSON.parse(text) as {id: string};\r\n        } else {\r\n            var id = ((e.dataTransfer.types as string[]).map(c => c.split(\"/\")).find(c => c[0] == \"id\") || [])[1]\r\n            if (id) {\r\n                swap(id, target)\r\n                /*\r\n                if (id == target.toLowerCase()) return\r\n                var item_index = list.findIndex(c => c.id.toLocaleLowerCase() == id )\r\n                var target_index = list.findIndex(c => c.id == target)  \r\n                var n_list = [];\r\n                \r\n                for (var i in list) {\r\n                    if ( n_list.length == target_index ) n_list.push(list[item_index])\r\n                    if (list[i].id.toLowerCase() != id) n_list.push(list[i])\r\n                }\r\n                if (n_list.findIndex(c => c.id == list[item_index].id) == -1) n_list.push(list[item_index])     \r\n\r\n                if (n_list.map(c=>c.id).join(\"\") != list.map(c=>c.id).join(\"\") ) setList(n_list)  \r\n                */\r\n\r\n            }\r\n        }\r\n    }\r\n    function onDragEnd(e) { \r\n        setDropMode(false)\r\n    }\r\n\r\n    function generarDocumento() {        \r\n        crearPDF(documents.map(c => c.buffer), list)\r\n    }\r\n    function dragoverfile(e) {\r\n        if (e.dataTransfer.types.includes(\"Files\") == false) return;\r\n        e.preventDefault();\r\n    }\r\n    async function getThumbnailsFromFile(file): Promise<PDFDocuments> {\r\n        var buffer = await file.arrayBuffer();\r\n        var imagenes = await getThumbnails(buffer)\r\n        return {buffer, imagenes}\r\n    }\r\n    async function procesarYMontarArchivos(files) {\r\n        var docs = [];\r\n        for (var f of files) {\r\n            var res = await getThumbnailsFromFile(f)        \r\n            list = list.concat(res.imagenes)\r\n            docs.push(res)\r\n        }\r\n\r\n      \r\n        setList(list)\r\n        setDocuments(documents.concat(docs))\r\n    }\r\n    async function dropfile(e) {  \r\n        if (e.dataTransfer.types.includes(\"Files\") == false) return;\r\n        e.preventDefault();\r\n\r\n        var files = []\r\n        if (e.dataTransfer.items) {\r\n            for (var i = 0; i < e.dataTransfer.items.length; i++) {\r\n              if (e.dataTransfer.items[i].kind === 'file') {\r\n                var file = e.dataTransfer.items[i].getAsFile();\r\n                files.push(file)\r\n              }\r\n            }\r\n          } else {\r\n            for (var i = 0; i < e.dataTransfer.files.length; i++) {\r\n                files.push(e.dataTransfer.files[i])\r\n            }\r\n          }\r\n\r\n        await procesarYMontarArchivos(files)\r\n\r\n        setDropMode(false)\r\n    }\r\n    function selectFiles(e) {\r\n        var input = document.createElement(\"input\")\r\n        input.type = \"file\"\r\n        input.multiple = true;\r\n        input.accept = \"application/pdf\";\r\n   \r\n        input.style.display = \"none\"\r\n        document.body.append(input)\r\n        input.onchange = async (e) => {\r\n            e.preventDefault();\r\n           var files = input.files;     \r\n   \r\n           await procesarYMontarArchivos(files)\r\n           document.body.removeChild(input)\r\n\r\n        }\r\n        input.click()\r\n    }\r\n\r\n    function onRemove(img) {\r\n        var index = list.findIndex(f => f.id == img.id)\r\n        if (index>=0){\r\n            list.splice(index, 1)\r\n            setList([...list])\r\n        } \r\n    }\r\n\r\n    function move(id, direction) {\r\n        var item_index = list.findIndex(c => c.id == id)\r\n        if (direction < 0 && item_index > 0) {       \r\n            var target_index = item_index - 1\r\n            swap(id, list[target_index].id)\r\n        } else if (direction> 0 && item_index < list.length -1 ) {\r\n            var target_index = item_index + 1\r\n            swap(id, list[target_index].id)\r\n        }\r\n    }\r\n\r\n    return (<div className=\"column editor flex\" \r\n    onDragLeave={e => setDropMode(false)} \r\n    onDragOver={dragoverfile} \r\n    onDrop={dropfile} >\r\n\r\n        <div className=\"flex\" style={{overflow: \"auto\", maxHeight: \"100vh\"}} onClick={selectFiles}>\r\n            <div className=\"page_list row flex\" style={{overflow: \"auto\"}} >\r\n                {dropMode == false && list.length ? list.map( (img)=> {\r\n                    return <PageItemView \r\n                    onRemove={onRemove}\r\n                    onDragEnd={onDragEnd}\r\n                    onDrop={onDragOver} \r\n                    onMove={move}\r\n                    onDragOver={onDragOver} imagen={img} key={img.id}/>\r\n                }): \r\n                    <div className=\"center\" style={{ padding: 50, width: \"100%\", height: \"100%\", background: \"#efefef\"}}>\r\n                        \r\n                        <h3>\r\n                            Ordena, agrega y elimina paginas de tus pdf\r\n                        </h3>\r\n                           <div className=\"center\">\r\n                           Haz click para seleccionar tus archivos o arrastralos hasta aqui y sueltalos aqui\r\n                           </div>\r\n                            <div style={{margin: 30}}>\r\n                                <img src=\"imgs/outline_picture_as_pdf_black_24dp.png\" />\r\n                            </div>\r\n                        </div>\r\n                }\r\n            </div>\r\n        </div>\r\n        <div style={{background: \"#313a46\", padding: 10}} className=\"row footer\">\r\n            <div className=\"flex\"></div>\r\n            <button onClick={generarDocumento}>Generar documento PDF</button>\r\n        </div>\r\n  \r\n  \r\n    </div>)\r\n}\r\n\r\nfunction PageItemView({imagen, onDragOver, onDrop, onDragEnd, onRemove, onMove}: \r\n    {imagen: {data: string, id: string}, onDragOver, onDrop, onDragEnd, onRemove, onMove}) {\r\n\r\n\r\n    var [mark, setMark] = useState(false);\r\n    var [gray, setGray] = useState(false);\r\n    function ondragstart(e) {\r\n        e.dataTransfer.setData(\"text\", JSON.stringify({id: imagen.id}));\r\n        e.dataTransfer.setData(\"id/\"+ imagen.id,  imagen.id)\r\n    }\r\n  \r\n    function ondragover(e) {   \r\n        setMark(true)   \r\n        var dataTransfer = e.dataTransfer;\r\n\r\n        var id = ((dataTransfer.types as string[]).map(c => c.split(\"/\")).find(c => c[0] == \"id\") || [])[1]\r\n\r\n        if (imagen.id.toLowerCase() == id) setGray(true) \r\n        onDragOver(e, imagen.id);        \r\n    }\r\n    function ondragleave(e) {\r\n        setMark(false)\r\n        setGray(false) \r\n    }\r\n\r\n    function remove(e) {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n        onRemove(imagen)\r\n    }\r\n    function move(e, direction) {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n        onMove(imagen.id, direction)\r\n    }\r\n\r\n\r\n    var style: any = {paddingBottom: 15};\r\n    if (mark) {\r\n        style.borderWidth = 2;\r\n        style.borderColor = \"#555\";\r\n        style.padding = 9;\r\n    }\r\n    if (gray) {\r\n        style.backgroundColor = \"#bbb\";\r\n    }\r\n    return (\r\n        <div onDrop={onDrop} onDragOver={ondragover} \r\n        onDragLeave={ondragleave} draggable \r\n        onDragStart={ondragstart}\r\n        onDragEnd={onDragEnd} \r\n        onClick={e => {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n        }}\r\n        className=\"page row item\" style={style}>\r\n            <div className=\"flex column\">                    \r\n                <div>              \r\n                    <img draggable={false} src={imagen.data} />     \r\n                </div>            \r\n            \r\n            <div className=\"row\">\r\n                <button onClick={remove} className=\"deletebutton\" style={{ float: \"right\"}}>\r\n                    X\r\n                </button>\r\n                <div className=\"center bold\" style={{paddingTop: 8}}> \r\n                    {imagen.id} \r\n                </div>        \r\n            </div>\r\n           </div>  \r\n           <div className=\"column sideControls\">\r\n                <button onClick={e => move(e, -1)} className=\"movebutton flex\">\r\n                    <img src=\"imgs/outline_arrow_back_ios_white_24dp.png\" className=\"icon\" />\r\n                </button>\r\n                <button onClick={e => move(e, 1)} className=\"movebutton flex\">\r\n                    <img src=\"imgs/outline_arrow_forward_ios_white_24dp.png\" className=\"icon\" />\r\n                </button>\r\n            </div> \r\n     \r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nfunction LeftPanel({className}) {\r\n    return <div className={\"sidebar \"+className}>\r\n        <div style={{width: 200}}>\r\n            \r\n        <div className=\"center\" style={{marginTop: 20}}>\r\n             PDF Sort\r\n        </div>\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 30}} />\r\n\r\n        <div className=\"center instrucciones\" style={{ fontSize: 13, fontWeight: 400, paddingTop: 10}}>\r\n            <ol>\r\n                <li>\r\n                Arrastra uno o varios documentos pdf desde tu ordenador, hasta el centro de la pagina.\r\n                </li>\r\n                <li>\r\n                Una vez se generen las imagenes de vista previa, ordena las hojas segun decees, o elimina las que no necesitas.\r\n                </li>\r\n                <li>\r\n                Finalmente haz click en generar documento, y descargalo. \r\n                </li>\r\n            </ol>\r\n          \r\n        </div>\r\n\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 30}} />\r\n\r\n        <div className=\"center\" style={{ fontSize: 13, fontWeight: 400, paddingTop: 10}}>\r\n             por Jesus L Zorrilla\r\n        </div>\r\n        <div className=\"center button\" style={{marginTop: 10, padding: 10, fontSize: 13, fontWeight: 400}}>\r\n             <a href=\"mailto:preefiapp@gmail.com\">\r\n             preefiapp@gmail.com\r\n             </a>\r\n        </div>\r\n\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 10}} />\r\n     \r\n       \r\n        <div className=\"center button\" style={{marginTop: 10, padding: 10, fontSize: 13, fontWeight: 400}}>\r\n             <a href=\"https://www.preefi.com\">\r\n                <div>\r\n                    www.preefi.com\r\n                </div>            \r\n             </a>\r\n        </div>\r\n        <div className=\"center\">\r\n             <a href=\"https://www.preefi.com\">\r\n                <img className=\"center\" src=\"https://www.preefi.com/icons/logos/logo_preefi_white.png\" />\r\n             </a>\r\n        </div>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\n\r\n\r\n\r\nasync function startApp() {\r\n    pdfjsLib.GlobalWorkerOptions.workerSrc = `dist/pdf.worker.js`\r\n    var docs: PDFDocuments[]  = [];\r\n    if (false) {\r\n        var buffer = await getPDFTEST(\"pdf/A1.pdf\")\r\n        var imagenes = await getThumbnails(buffer);\r\n        docs.push({buffer, imagenes})\r\n    }\r\n    \r\n    ReactDOM.render(<MainApp docs={docs} />, document.getElementById(\"core\") )\r\n\r\n}\r\n\r\nstartApp()\r\n\r\n","export async function getPDFTEST(url) {\r\n    return fetch(url).then(res => {\r\n        return res.arrayBuffer()\r\n    })\r\n}","\r\nexport declare const pdfjsLib: typeof import(\"pdfjs-dist\")\r\n\r\nexport var current_code = 0;\r\nexport var abc = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n\r\nexport async function getThumbnails(path: string | ArrayBuffer = \"../pdf/test.pdf\") {\r\n    return new Promise<{ data: string; id: any; page_number: number; }[]>((resolve, reject) => {\r\n\r\n        current_code++;\r\n        var imagenes = [];\r\n        pdfjsLib.getDocument(path as any).promise.then(async (doc) => {\r\n\r\n            var paginas = doc.numPages;\r\n            for (var page_index = 1; page_index <= paginas; page_index++) {\r\n                var canvas = document.createElement(\"canvas\") as HTMLCanvasElement;\r\n                var canvasContext = canvas.getContext(\"2d\");\r\n\r\n                var page = await doc.getPage(page_index);\r\n                var viewport = page.getViewport({ scale: 0.2 });\r\n                canvas.height = viewport.height;\r\n                canvas.width = viewport.width;\r\n\r\n                await page.render({ canvasContext, viewport }).promise;\r\n                var img = canvas.toDataURL(\"image/png\");\r\n                imagenes.push({ data: img, page_number: page_index, id: abc[(current_code - 1) % (abc.length)] + page_index });\r\n            }\r\n\r\n\r\n            resolve(imagenes);\r\n        }).catch(err => {\r\n            console.error(err)\r\n            alert(`Error, uno de los archivos no es un documento PDF valido`)\r\n            resolve([])\r\n        });\r\n    });\r\n}\r\n","import * as download from \"downloadjs\";\r\n\r\nexport function crearPDF(files: any[], order: { id: string; page_number: number; file_id: string; }[]) {\r\n    var form = new FormData();\r\n    for (var f of files)\r\n        form.append(\"files\", new Blob([f], { type: \"application/pdf\" }));\r\n    form.append(\"orden\", JSON.stringify(order.map(c => {\r\n        return { id: c.id, page_number: c.page_number, file_id: c.id[0] };\r\n    })));\r\n    return fetch(\"/api/pdf/upload\", {\r\n        body: form,\r\n        method: \"POST\",\r\n    }).then(response => {\r\n        console.log(response)\r\n        return response.arrayBuffer()//.blob()\r\n    })\r\n        .then(blob => {\r\n            console.log(\"descargar a la pc\", blob)\r\n            download(blob, \"concat.pdf\", \"application/pdf\");\r\n            return;\r\n            var url = window.URL.createObjectURL(blob);\r\n            var a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = \"concat.pdf\";\r\n            document.body.appendChild(a); // we need to append the element to the dom -> otherwise it will not work in firefox\r\n            a.click();\r\n            a.remove(); //afterwards we remove the element again         \r\n        }).catch(err => {\r\n            console.error(err)\r\n        });\r\n}\r\n"]}