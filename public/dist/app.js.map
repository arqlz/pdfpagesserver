{"version":3,"sources":["public/src/app.tsx","public/src/utls/loader.ts","public/src/getThumbnails.tsx","public/src/crearPDF.tsx"],"names":["useState","useCallback","useEffect","React","docs","sideBarVisivility","setSideBarVisivility","check","a","test","substr","navigator","userAgent","vendor","window","opera","e","height","width","padding","overflow","LeftPanel","PageEditor","list","setList","documents","setDocuments","dropMode","setDropMode","imagenes","d","concat","target","console","log","dataTransfer","types","includes","preventDefault","text","getData","data","JSON","parse","id","map","c","split","find","toLowerCase","item_index","findIndex","toLocaleLowerCase","target_index","n_list","i","length","push","join","crearPDF_1","buffer","file","arrayBuffer","getThumbnails_1","files","items","kind","getAsFile","f","res","getThumbnailsFromFile","img","index","splice","dragoverfile","dropfile","maxHeight","PageItemView","onRemove","onDragEnd","onDragOver","background","generarDocumento","imagen","onDrop","mark","setMark","gray","setGray","setData","stringify","style","paddingBottom","borderWidth","borderColor","backgroundColor","ondragover","ondragleave","ondragstart","remove","paddingTop","className","marginTop","borderTop","fontSize","fontWeight","pdfjsLib","GlobalWorkerOptions","workerSrc","loader_1","ReactDOM","render","MainApp","document","getElementById","startApp","url","fetch","then","path","Promise","resolve","reject","exports","getDocument","promise","doc","paginas","numPages","page_index","canvas","createElement","canvasContext","getContext","page","getPage","viewport","getViewport","scale","toDataURL","page_number","catch","err","error","alert","order","form","FormData","append","Blob","type","file_id","body","method","response","blob","URL","createObjectURL","href","download","appendChild","click"],"mappings":"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","file":"","sourcesContent":["\r\nimport { getPDFTEST } from \"./utls/loader\";\r\nexport declare const pdfjsLib: typeof import(\"pdfjs-dist\")\r\ndeclare const React: typeof import(\"react\")\r\ndeclare const ReactDOM: typeof import(\"react-dom\")\r\nvar {useState, useCallback, useEffect} = React;\r\nimport { getThumbnails } from \"./getThumbnails\";\r\nimport { crearPDF } from \"./crearPDF\";\r\n\r\ninterface ImageItem {\r\n    id: string;\r\n    data?: string;\r\n    page_number: number;\r\n}\r\ninterface PDFDocuments {\r\n    buffer: ArrayBuffer;\r\n    imagenes: ImageItem[]\r\n}\r\n\r\n\r\nfunction MainApp({docs}: {docs: PDFDocuments[]}) {\r\n    var [sideBarVisivility, setSideBarVisivility] = useState(true)\r\n    useEffect(() => {\r\n        let check = false;\r\n        (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n        if (check) setSideBarVisivility(false)\r\n\r\n    }, [])\r\n    return <div className=\"column main\">\r\n        <div onClick={e => setSideBarVisivility(!sideBarVisivility) } style={{height: 55}} >\r\n            <img style={{width: 30, padding: 10}} src=\"imgs/outline_menu_black_24dp.png\" />\r\n        </div>\r\n        <div className=\"row flex\" style={{overflow: \"hidden\", \"flex-wrap\": \"nowrap\"}}> \r\n       \r\n            <LeftPanel className={sideBarVisivility? \"\" : \"sidebarhide\"} />               \r\n            <PageEditor docs={docs} />\r\n        </div>\r\n    </div>\r\n}\r\n\r\nfunction PageEditor({docs}: {docs: PDFDocuments[]}) {\r\n    var [list, setList] = useState([])\r\n    var [documents, setDocuments] = useState(docs)\r\n    var [dropMode, setDropMode] = useState(false)\r\n    useEffect(() => {\r\n        var imagenes = []\r\n        for (var d of documents) imagenes = imagenes.concat(d.imagenes)\r\n        setList(imagenes)\r\n\r\n    }, [])\r\n    function onDragOver(e, target) {   \r\n        console.log(\"DRAG OVER\") \r\n        if (e.dataTransfer.types.includes(\"Files\") ) {\r\n            e.preventDefault();\r\n            setDropMode(true)\r\n            return\r\n        }\r\n        var text = e.dataTransfer.getData(\"text\");\r\n        if (text) {\r\n            var data = JSON.parse(text) as {id: string};\r\n        } else {\r\n            var id = ((e.dataTransfer.types as string[]).map(c => c.split(\"/\")).find(c => c[0] == \"id\") || [])[1]\r\n            if (id) {\r\n    \r\n                if (id == target.toLowerCase()) return\r\n                var item_index = list.findIndex(c => c.id.toLocaleLowerCase() == id )\r\n                var target_index = list.findIndex(c => c.id == target)  \r\n                var n_list = [];\r\n                \r\n                for (var i in list) {\r\n                    if ( n_list.length == target_index ) n_list.push(list[item_index])\r\n                    if (list[i].id.toLowerCase() != id) n_list.push(list[i])\r\n                }\r\n                if (n_list.findIndex(c => c.id == list[item_index].id) == -1) n_list.push(list[item_index])     \r\n\r\n                if (n_list.map(c=>c.id).join(\"\") != list.map(c=>c.id).join(\"\") ) setList(n_list)  \r\n\r\n            }\r\n        }\r\n    }\r\n    function onDragEnd(e) { \r\n        setDropMode(false)\r\n    }\r\n\r\n    function generarDocumento() {        \r\n        crearPDF(documents.map(c => c.buffer), list)\r\n    }\r\n    function dragoverfile(e) {\r\n        if (e.dataTransfer.types.includes(\"Files\") == false) return;\r\n        e.preventDefault();\r\n    }\r\n    async function getThumbnailsFromFile(file): Promise<PDFDocuments> {\r\n        var buffer = await file.arrayBuffer();\r\n        var imagenes = await getThumbnails(buffer)\r\n        return {buffer, imagenes}\r\n    }\r\n    async function dropfile(e) {  \r\n        if (e.dataTransfer.types.includes(\"Files\") == false) return;\r\n        e.preventDefault();\r\n\r\n        var files = []\r\n        if (e.dataTransfer.items) {\r\n            for (var i = 0; i < e.dataTransfer.items.length; i++) {\r\n              if (e.dataTransfer.items[i].kind === 'file') {\r\n                var file = e.dataTransfer.items[i].getAsFile();\r\n                files.push(file)\r\n              }\r\n            }\r\n          } else {\r\n            for (var i = 0; i < e.dataTransfer.files.length; i++) {\r\n                files.push(e.dataTransfer.files[i])\r\n            }\r\n          }\r\n\r\n        var docs = [];\r\n        for (var f of files) {\r\n            var res = await getThumbnailsFromFile(f)        \r\n            list = list.concat(res.imagenes)\r\n            docs.push(res)\r\n        }\r\n        console.log(docs)\r\n      \r\n        setList(list)\r\n        setDocuments(documents.concat(docs))\r\n        setDropMode(false)\r\n    }\r\n\r\n    function onRemove(img) {\r\n        var index = list.findIndex(f => f.id == img.id)\r\n        if (index>=0){\r\n            list.splice(index, 1)\r\n            setList([...list])\r\n        } \r\n    }\r\n\r\n    return (<div className=\"column editor flex\" onDragLeave={e => setDropMode(false)} onDragOver={dragoverfile} onDrop={dropfile} >\r\n\r\n        <div className=\"flex\" style={{overflow: \"auto\", maxHeight: \"100vh\"}}>\r\n            <div className=\"page_list row flex\" style={{overflow: \"auto\"}} >\r\n                {dropMode == false && list.length ? list.map( (img)=> {\r\n                    return <PageItemView \r\n                    onRemove={onRemove}\r\n                    onDragEnd={onDragEnd}\r\n                    onDrop={onDragOver} \r\n                    onDragOver={onDragOver} imagen={img} key={img.id}/>\r\n                }): \r\n                    <div className=\"center\" style={{ padding: 50, width: \"100%\", background: \"#efefef\"}}>Arroja un archivo</div>\r\n                }\r\n            </div>\r\n        </div>\r\n        <div style={{background: \"#313a46\", padding: 10}} className=\"row\">\r\n            <div className=\"flex\"></div>\r\n            <button onClick={generarDocumento}>Generar documento PDF</button>\r\n        </div>\r\n  \r\n  \r\n    </div>)\r\n}\r\n\r\n\r\nfunction PageItemView({imagen, onDragOver, onDrop, onDragEnd, onRemove}: \r\n    {imagen: {data: string, id: string}, onDragOver, onDrop, onDragEnd, onRemove}) {\r\n\r\n\r\n    var [mark, setMark] = useState(false);\r\n    var [gray, setGray] = useState(false);\r\n    function ondragstart(e) {\r\n        e.dataTransfer.setData(\"text\", JSON.stringify({id: imagen.id}));\r\n        e.dataTransfer.setData(\"id/\"+ imagen.id,  imagen.id)\r\n    }\r\n  \r\n    function ondragover(e) {    \r\n        setMark(true)   \r\n        var id = ((e.dataTransfer.types as string[]).map(c => c.split(\"/\")).find(c => c[0] == \"id\") || [])[1]\r\n\r\n        if (imagen.id.toLowerCase() == id) setGray(true) \r\n        onDragOver(e, imagen.id);        \r\n    }\r\n    function ondragleave(e) {\r\n        setMark(false)\r\n        setGray(false) \r\n    }\r\n\r\n    function remove(e) {\r\n        onRemove(imagen)\r\n    }\r\n\r\n\r\n    var style: any = {paddingBottom: 15};\r\n    if (mark) {\r\n        style.borderWidth = 2;\r\n        style.borderColor = \"#555\";\r\n        style.padding = 9;\r\n    }\r\n    if (gray) {\r\n        style.backgroundColor = \"#bbb\";\r\n    }\r\n    return (\r\n        <div onDrop={onDrop} onDragOver={ondragover} onDragLeave={ondragleave} draggable onDragStart={ondragstart} \r\n        onDragEnd={onDragEnd} className=\"page column item\" \r\n            style={style}>           \r\n                <img draggable={false} src={imagen.data} />         \r\n           \r\n           <div className=\"row\">\r\n            <button onClick={remove} className=\"deletebutton\">X</button>\r\n            <div className=\"center bold\" style={{paddingTop: 8}}> {imagen.id} </div>\r\n           </div>\r\n     \r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nfunction LeftPanel({className}) {\r\n    return <div className={\"sidebar \"+className}>\r\n        <div style={{width: 200}}>\r\n            \r\n        <div className=\"center\" style={{marginTop: 20}}>\r\n             PDF Sort\r\n        </div>\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 30}} />\r\n\r\n        <div className=\"center instrucciones\" style={{ fontSize: 13, fontWeight: 400, paddingTop: 10}}>\r\n            <ol>\r\n                <li>\r\n                Arrastra uno o varios documentos pdf desde tu ordenador, hasta el centro de la pagina.\r\n                </li>\r\n                <li>\r\n                Una vez se generen las imagenes de vista previa, ordena las hojas segun decees, o elimina las que no necesitas.\r\n                </li>\r\n                <li>\r\n                Finalmente haz click en generar documento, y descargalo. \r\n                </li>\r\n            </ol>\r\n          \r\n        </div>\r\n\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 30}} />\r\n\r\n        <div className=\"center\" style={{ fontSize: 13, fontWeight: 400, paddingTop: 10}}>\r\n             por Jesus L Zorrilla\r\n        </div>\r\n        <div className=\"center button\" style={{marginTop: 10, padding: 10, fontSize: 13, fontWeight: 400}}>\r\n             <a href=\"mailto:preefiapp@gmail.com\">\r\n             preefiapp@gmail.com\r\n             </a>\r\n        </div>\r\n\r\n        <div className=\"center\" style={{ borderTop: \"solid 1px #cccccc\", marginTop: 10}} />\r\n     \r\n       \r\n        <div className=\"center button\" style={{marginTop: 10, padding: 10, fontSize: 13, fontWeight: 400}}>\r\n             <a href=\"https://www.preefi.com\">\r\n                <div>\r\n                    www.preefi.com\r\n                </div>            \r\n             </a>\r\n        </div>\r\n        <div className=\"center\">\r\n             <a href=\"https://www.preefi.com\">\r\n                <img className=\"center\" src=\"https://www.preefi.com/icons/logos/logo_preefi_white.png\" />\r\n             </a>\r\n        </div>\r\n        </div>\r\n\r\n    </div>\r\n}\r\n\r\n\r\n\r\n\r\nasync function startApp() {\r\n    pdfjsLib.GlobalWorkerOptions.workerSrc = `dist/pdf.worker.js`\r\n    var docs: PDFDocuments[]  = [];\r\n    if (false) {\r\n        var buffer = await getPDFTEST(\"pdf/A1.pdf\")\r\n        var imagenes = await getThumbnails(buffer);\r\n        docs.push({buffer, imagenes})\r\n\r\n        buffer = await getPDFTEST(\"pdf/D1.pdf\")\r\n        imagenes = await getThumbnails(buffer);\r\n        docs.push({buffer, imagenes})\r\n        docs.push({buffer, imagenes})\r\n    }\r\n    \r\n    ReactDOM.render(<MainApp docs={docs} />, document.getElementById(\"core\") )\r\n\r\n}\r\n\r\nstartApp()\r\n\r\n","export async function getPDFTEST(url) {\r\n    return fetch(url).then(res => {\r\n        return res.arrayBuffer()\r\n    })\r\n}","\r\nexport declare const pdfjsLib: typeof import(\"pdfjs-dist\")\r\n\r\nexport var current_code = 0;\r\nexport var abc = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n\r\nexport async function getThumbnails(path: string | ArrayBuffer = \"../pdf/test.pdf\") {\r\n    return new Promise<{ data: string; id: any; page_number: number; }[]>((resolve, reject) => {\r\n\r\n        current_code++;\r\n        var imagenes = [];\r\n        pdfjsLib.getDocument(path as any).promise.then(async (doc) => {\r\n\r\n            var paginas = doc.numPages;\r\n            for (var page_index = 1; page_index <= paginas; page_index++) {\r\n                var canvas = document.createElement(\"canvas\") as HTMLCanvasElement;\r\n                var canvasContext = canvas.getContext(\"2d\");\r\n\r\n                var page = await doc.getPage(page_index);\r\n                var viewport = page.getViewport({ scale: 0.2 });\r\n                canvas.height = viewport.height;\r\n                canvas.width = viewport.width;\r\n\r\n                await page.render({ canvasContext, viewport }).promise;\r\n                var img = canvas.toDataURL(\"image/png\");\r\n                imagenes.push({ data: img, page_number: page_index, id: abc[(current_code - 1) % (abc.length)] + page_index });\r\n            }\r\n\r\n\r\n            resolve(imagenes);\r\n        }).catch(err => {\r\n            console.error(err)\r\n            alert(`Error, uno de los archivos no es un documento PDF valido`)\r\n            resolve([])\r\n        });\r\n    });\r\n}\r\n","import * as download from \"downloadjs\";\r\n\r\nexport function crearPDF(files: any[], order: { id: string; page_number: number; file_id: string; }[]) {\r\n    var form = new FormData();\r\n    for (var f of files)\r\n        form.append(\"files\", new Blob([f], { type: \"application/pdf\" }));\r\n    form.append(\"orden\", JSON.stringify(order.map(c => {\r\n        return { id: c.id, page_number: c.page_number, file_id: c.id[0] };\r\n    })));\r\n    return fetch(\"/api/pdf/upload\", {\r\n        body: form,\r\n        method: \"POST\",\r\n    }).then(response => {\r\n        console.log(response)\r\n        return response.arrayBuffer()//.blob()\r\n    })\r\n        .then(blob => {\r\n            console.log(\"descargar a la pc\", blob)\r\n            download(blob, \"concat.pdf\", \"application/pdf\");\r\n            return;\r\n            var url = window.URL.createObjectURL(blob);\r\n            var a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = \"concat.pdf\";\r\n            document.body.appendChild(a); // we need to append the element to the dom -> otherwise it will not work in firefox\r\n            a.click();\r\n            a.remove(); //afterwards we remove the element again         \r\n        }).catch(err => {\r\n            console.error(err)\r\n        });\r\n}\r\n"]}